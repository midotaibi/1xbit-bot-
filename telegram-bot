#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Ø¨ÙˆØª ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ - Ø¥ØµØ¯Ø§Ø± 1.0
Ù…Ø®ØµØµ Ù„Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub
"""

import os
import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Updater,
    CommandHandler,
    CallbackContext,
    CallbackQueryHandler,
    MessageHandler,
    Filters
)

# ------ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© ------
TOKEN = os.getenv('7868580704:AAEdu4oxJcGJmExFbsEY6JX2eOilTg60l6Y')  # Ø³ÙŠØªÙ… Ù‚Ø±Ø§Ø¡ØªÙ‡ Ù…Ù† Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
ADMIN_ID = 7868580704  # Ø¶Ø¹ Ø±Ù‚Ù…Ùƒ Ù‡Ù†Ø§
LOG_FILE = 'bot.log'

# ------ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø¬Ù„ ------
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler(LOG_FILE),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ------ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª ------
def start(update: Update, context: CallbackContext):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /start"""
    user = update.effective_user
    keyboard = [
        [InlineKeyboardButton("ğŸ¯ ØªÙˆÙ‚Ø¹ Ù…Ø¨Ø§Ø±Ø§Ø©", callback_data='predict')],
        [InlineKeyboardButton("ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", callback_data='stats')],
        [InlineKeyboardButton("â„¹ï¸ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©", callback_data='help')]
    ]
    update.message.reply_text(
        f"Ù…Ø±Ø­Ø¨Ø§Ù‹ {user.first_name}! ğŸ‘‹\nØ§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:",
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

def help_command(update: Update, context: CallbackContext):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /help"""
    help_text = """
    ğŸ†˜ <b>ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</b>
    
    /start - Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
    /predict - ØªÙˆÙ‚Ø¹ Ù…Ø¨Ø§Ø±Ø§Ø©
    /stats - Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    
    ğŸ’¡ <i>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ùˆ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø¨Ø§Ø´Ø±Ø©</i>
    """
    update.message.reply_text(help_text, parse_mode='HTML')

# ------ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± ------
def button_handler(update: Update, context: CallbackContext):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¶ØºØ·Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±"""
    query = update.callback_query
    query.answer()
    
    if query.data == 'predict':
        query.edit_message_text("Ø£Ø±Ø³Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø¶Ø¯ Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ)")
        context.user_data['awaiting'] = 'prediction'
    elif query.data == 'stats':
        query.edit_message_text("ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹...")
    elif query.data == 'help':
        help_command(update, context)

# ------ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ------
def handle_message(update: Update, context: CallbackContext):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©"""
    if context.user_data.get('awaiting') == 'prediction':
        match = update.message.text
        update.message.reply_text(f"Ø¬Ø§Ø±Ù ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: {match}...")
        # Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        context.user_data['awaiting'] = None

# ------ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ------
def main():
    """ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª"""
    try:
        updater = Updater(TOKEN)
        dp = updater.dispatcher
        
        # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª
        dp.add_handler(CommandHandler("start", start))
        dp.add_handler(CommandHandler("help", help_command))
        dp.add_handler(CallbackQueryHandler(button_handler))
        dp.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))
        
        logger.info("âœ… Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†...")
        updater.start_polling()
        updater.idle()
    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£: {e}")

if __name__ == '__main__':
    main()
